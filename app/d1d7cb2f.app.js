"use strict";angular.module("pizzaApp",["ui.router","ui.bootstrap"]).constant("env",{host:"http://162.250.78.47",api:"/api",pizzas:"/pizzas",ingredients:"/ingredients"}).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),c.html5Mode(!0)}]),angular.module("pizzaApp").controller("DetailCtrl",["$scope","$stateParams","pizza","ingredient","$state",function(a,b,c,d,e){function f(){var b=!0;return a.pizza.ingredients.length||(b=!1),b}var g=b.pizzaId;a.pizza={},a.pizza.ingredients=[],g&&c.get(g).then(function(b){a.pizza=b}),a.ingredients=[],d.get().then(function(b){a.ingredients=b}),a.addIngredient=function(b){b&&a.pizza.ingredients.push(b)},a.save=function(){f()?a.pizza._id?c.update(a.pizza).then(function(a){e.go("main")}):c.create(a.pizza).then(function(a){e.go("main")}):alert("Please use at least one ingredient for this pizza")}}]),angular.module("pizzaApp").config(["$stateProvider",function(a){a.state("detail",{url:"/detail",params:{pizzaId:null},templateUrl:"/pizza-test/app/components/detail/detail.html",controller:"DetailCtrl"})}]),angular.module("pizzaApp").directive("pizzaIngredients",["ingredient","$q","$window",function(a,b,c){return{templateUrl:"/pizza-test/app/components/detail/pizzaIngredients/pizzaIngredients.html",restrict:"EA",link:function(d,e,f){function g(){var c,e=h(d.list),f=e[0].length,g=[];for(c=0;f>c;c++)g.push(a.get(e[0][c]));b.all(g).then(function(a){for(d.nameList=[],c=0;f>c;c++)d.nameList.push({no:e[1][c],_id:a[c]._id,name:a[c].name})})}function h(a){var b,c=[],d=[];if(a){a.sort();for(var e=0;e<a.length;e++)a[e]!==b?(c.push(a[e]),d.push(1)):d[d.length-1]++,b=a[e]}return[c,d]}d.list=[],d.nameList=[],d.$watchCollection(function(){return d.pizza.ingredients},function(a,b,c){a&&(d.list=a,g())}),d.remove=function(a,b){var e=angular.copy(d.pizza.ingredients),f=c.confirm("Are you sure you want to remove this ingredient?");f&&(b?e.splice(e.indexOf(a),1):e=e.filter(function(b){return b!==a})),d.pizza.ingredients=e}}}}]),angular.module("pizzaApp").controller("MainCtrl",["$scope","pizza","$state","$window",function(a,b,c,d){function e(){b.get().then(function(b){a.pizzas=b})}a.pizzas=[],e(),a.newPizza=function(){c.go("detail")},a.removePizza=function(a){var c=d.confirm("Are you sure you want to remove this pizza?");c&&b.remove(a).then(function(a){e()})}}]),angular.module("pizzaApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"/pizza-test/app/components/main/main.html",controller:"MainCtrl"})}]),angular.module("pizzaApp").service("ingredient",["$http","$q","env",function(a,b,c){function d(b){var c=b?"/"+b:"",d=a({method:"GET",url:g+c,headers:{"Content-Type":"application/json"}});return d.then(f,e)}function e(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function f(a){return a.data}var g=c.host+c.api+c.ingredients;return{get:d}}]),angular.module("pizzaApp").service("pizza",["$http","$q","env",function(a,b,c){function d(b){var c=b?"/"+b:"",d=a({method:"GET",url:j+c,headers:{"Content-Type":"application/json"}});return d.then(i,h)}function e(b){var c=a({method:"POST",url:j,headers:{"Content-Type":"application/json"},data:angular.toJson(b)});return c.then(i,h)}function f(b){var c=b._id,d=a({method:"PUT",url:j+"/"+c,headers:{"Content-Type":"application/json"},data:angular.toJson(b)});return d.then(i,h)}function g(b){var c=a({method:"DELETE",url:j+"/"+b,headers:{"Content-Type":"application/json"}});return c.then(i,h)}function h(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function i(a){return a.data}var j=c.host+c.api+c.pizzas;return{get:d,create:e,update:f,remove:g}}]),angular.module("pizzaApp").run(["$templateCache",function(a){a.put("/pizza-test/app/components/detail/detail.html",'<header class="header detail"><div class=container><a ui-sref=main class="home-link pull-left"><i class="fa fa-chevron-left"></i> Home</a></div></header><div class=container><div class=row><div class="col-lg-3 col-md-2 col-sm-1 col-xs-12"></div><div class="col-lg-6 col-md-8 col-sm-10 col-xs-12"><form name=pizzaForm><div class=form-group><label>Pizza Name</label><input class=form-control placeholder="" name=name ng-model=pizza.name required ng-required=true><p ng-show="pizzaForm.name.$invalid && !pizzaForm.name.$pristine" class=help-block>Name is required.</p></div><div class=form-group><div class=radio ng-repeat="item in (ingredients | orderBy : \'name\')"><label><input type=radio name=ingredient ng-value=item._id value={{item._id}} ng-model=$parent.selected> {{item.name}}</label></div></div><button type=button class="btn btn-default btn-lg hidden-xs" ng-click=addIngredient(selected) ng-disabled=!selected>Add Ingredient</button> <button type=button class="btn btn-default btn-lg btn-block visible-xs" ng-click=addIngredient(selected) ng-disabled=!selected>Add Ingredient</button></form></div><div class="col-lg-3 col-md-2 col-sm-1 col-xs-12"></div></div></div><pizza-ingredients></pizza-ingredients><div class=container><div class=row><div class="col-lg-3 col-md-2 col-sm-1 col-xs-12"></div><div class="col-lg-6 col-md-8 col-sm-10 col-xs-12"><button type=button class="hidden-xs btn btn-primary btn-lg" ng-click=save(pizza) ng-disabled=pizzaForm.$invalid>Save</button> <button type=button class="visible-xs btn btn-primary btn-lg btn-block" ng-click=save(pizza) ng-disabled=pizzaForm.$invalid>Save</button></div><div class="col-lg-3 col-md-2 col-sm-1 col-xs-12"></div></div></div>'),a.put("/pizza-test/app/components/detail/pizzaIngredients/pizzaIngredients.html",'<div class=container><div class=row><div class="col-lg-3 col-md-2 col-sm-1 col-xs-12"></div><div class="col-lg-6 col-md-8 col-sm-10 col-xs-12"><ul class="nav nav-tabs nav-stacked ingredient-list"><li ng-repeat="item in nameList">{{item.no}} x {{item.name}} <span class="pull-right ingredient-actions"><i class="fa fa-minus" ng-click="remove(item._id, true)"></i> <i class="fa fa-trash" ng-click=remove(item._id)></i></span></li></ul></div><div class="col-lg-3 col-md-2 col-sm-1 col-xs-12"></div></div></div>'),a.put("/pizza-test/app/components/main/main.html",'<header class="home header" id=banner><div class=container><h1>Pizzas App</h1></div></header><div class=container><div class=row><div class=col-lg-12><div class=row><div class="col-lg-4 col-md-4 col-sm-1 col-xs-12"></div><ul class="pizza-list col-md-4 col-lg-4 col-sm-10 col-xs-12"><li ng-repeat="pizza in pizzas" ng-if=pizza.name><a ui-sref="detail({pizzaId: \'{{pizza._id}}\'})">{{pizza.name}}</a> <i class="pull-right fa fa-trash" ng-click=removePizza(pizza._id)></i></li></ul><div class="col-lg-4 col-md-4 col-sm-1 col-xs-12"></div></div></div></div></div><div class=container><div class=row><div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div><div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"><button type=button class="hidden-xs btn btn-primary btn-lg" ng-click=newPizza()>New Pizza</button> <button type=button class="visible-xs btn btn-primary btn-lg btn-block" ng-click=newPizza()>New Pizza</button></div><div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div></div></div>')}]);